---
import "@styles/global.css";
import "@fontsource/inter";
import "@fontsource/fira-code";
import { ClientRouter } from "astro:transitions";
import NavBar from "@components/shared/NavBar.astro";
import Footer from "@components/shared/Footer.astro";

interface Props {
  title: string;
}

const { title = "David Glassman" } = Astro.props;
---

<script is:inline>
  function setDarkMode(document) {
    const getThemePreference = () => {
      if (
        typeof localStorage !== "undefined" &&
        localStorage.getItem("theme")
      ) {
        return localStorage.getItem("theme");
      }

      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    };

    const isDark = getThemePreference() === "dark";
    document.documentElement.classList[isDark ? "add" : "remove"]("dark");

    if (typeof localStorage !== "undefined") {
      const observer = new MutationObserver(() => {
        const isDark = document.documentElement.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });

      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ["class"],
      });
    }
  }

  setDarkMode(document);

  document.addEventListener("astro:before-swap", (ev) => {
    setDarkMode(ev.newDocument);
  });
</script>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width"
    />
    <meta
      name="generator"
      content={Astro.generator}
    />

    <title>{title}</title>

    <ClientRouter />
  </head>

  <body class="scrollbar">
    <div
      class="mx-auto flex min-h-lvh max-w-[50rem] flex-col items-start justify-between gap-4 p-4 py-8"
    >
      <div class="flex-col-standard gap-16">
        <NavBar />

        <div class="flex-col-standard gap-12">
          <slot />
        </div>
      </div>

      <Footer />
    </div>
  </body>
</html>
